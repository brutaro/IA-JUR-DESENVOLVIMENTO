# üîß Configura√ß√£o Atual do Agente - Documenta√ß√£o T√©cnica Completa

## üìã Informa√ß√µes Gerais

**Data de Cria√ß√£o**: 13 de Agosto de 2025  
**Vers√£o**: 2.0-simplificada-restaurada  
**Status**: ‚úÖ **SISTEMA TOTALMENTE OPERACIONAL**  
**√öltima Atualiza√ß√£o**: Restaura√ß√£o completa do sistema  

## üèóÔ∏è Arquitetura do Sistema Restaurado

### **Diagrama de Alto N√≠vel**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Interface     ‚îÇ    ‚îÇ    Orquestrador      ‚îÇ    ‚îÇ   Agente         ‚îÇ
‚îÇ   do Usu√°rio    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    Simplificado      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Pesquisador    ‚îÇ
‚îÇ  (simple_main)  ‚îÇ    ‚îÇ (simple_orchestrator)‚îÇ    ‚îÇ (research_agent) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                           ‚îÇ
                                ‚ñº                           ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   Gloss√°rio     ‚îÇ         ‚îÇ      LLM        ‚îÇ
                       ‚îÇ   T√©cnico       ‚îÇ         ‚îÇ  (Gemini 2.5)   ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                           ‚îÇ
                                ‚ñº                           ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   Pinecone      ‚îÇ         ‚îÇ   Resposta      ‚îÇ
                       ‚îÇ (Host Personalizado)      ‚îÇ   Formatada     ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîë Configura√ß√µes de Chaves e APIs

### **1. Google Gemini API**
```bash
# Arquivo: .env
GEMINI_API_KEY=your_gemini_api_key_here
GOOGLE_API_KEY=your_gemini_api_key_here
```

**Configura√ß√µes do LLM**:
- **Modelo**: `gemini-2.5-flash`
- **Provider**: Google
- **Temperature**: 0.1 (determin√≠stico)
- **Max Tokens**: 6000
- **API Endpoint**: Autom√°tico via SDK

### **2. Pinecone Vector Database**
```bash
# Arquivo: .env
PINECONE_API_KEY=your_pinecone_api_key_here
PINECONE_INDEX=agentes-juridicos
PINECONE_ENVIRONMENT=us-east-1
```

**Configura√ß√£o Especial**:
- **Host Personalizado**: `agentes-juridicos-10b89ab.svc.aped-4627-b74a.pinecone.io`
- **√çndice**: `agentes-juridicos`
- **Ambiente**: `us-east-1` (configurado mas n√£o usado)
- **Total de Vetores**: 6.967
- **Dimens√µes**: 768

## üîç Sistema de Retrieval do Pinecone

### **1. Implementa√ß√£o Atual**
O sistema usa uma **implementa√ß√£o personalizada** que contorna o SDK padr√£o do Pinecone devido a problemas de DNS.

### **2. Arquivo Principal**
```python
# src/tools/pinecone_search_tool.py
class PineconeSearchTool:
    def __init__(self):
        # Host personalizado que funciona
        self.custom_host = "agentes-juridicos-10b89ab.svc.aped-4627-b74a.pinecone.io"
        self.api_key = pinecone_api_key
```

### **3. Processo de Retrieval**
```python
def _query_pinecone_custom(self, vector: List[float], top_k: int = 5):
    # URL para query no host personalizado
    query_url = f"https://{self.custom_host}/query"
    
    # Headers necess√°rios
    headers = {
        'Api-Key': self.api_key,
        'Content-Type': 'application/json'
    }
    
    # Payload da query
    payload = {
        'vector': vector,
        'topK': top_k,
        'includeMetadata': True
    }
    
    # Executa query via HTTP POST
    response = requests.post(query_url, headers=headers, json=payload, timeout=30)
```

### **4. Embedding Model**
```python
# Configura√ß√µes do embedding
self.config = {
    'embedding_model': 'models/text-embedding-004',
    'top_k': 15,
    'similarity_threshold': 0.3,
    'final_result_count': 10,
    'task_type': 'retrieval_query'
}
```

### **5. Fluxo de Retrieval Completo**
```
1. Input Query ‚Üí Texto da consulta
2. Embedding Generation ‚Üí text-embedding-004 (768 dimens√µes)
3. HTTP POST ‚Üí Host personalizado do Pinecone
4. Vector Search ‚Üí Busca por similaridade
5. Results Filtering ‚Üí Threshold 0.3+
6. Metadata Extraction ‚Üí Metadados dos documentos
7. Response Formatting ‚Üí Formato padronizado
```

## üß† Configura√ß√£o do LLM (Gemini 2.5)

### **1. Inicializa√ß√£o**
```python
# src/agents/research_agent.py
def _create_llm_instance(self):
    import google.generativeai as genai
    
    api_key = self.llm_config.get('api_key') or os.getenv('GEMINI_API_KEY')
    genai.configure(api_key=api_key)
    model = genai.GenerativeModel(self.llm_config.get('model', 'gemini-2.5-flash'))
    return model
```

### **2. Configura√ß√µes de Prompt**
```python
# Prompt para s√≠ntese espec√≠fica e objetiva
synthesis_prompt = f"""
Voc√™ √© um especialista jur√≠dico. Com base nos documentos fornecidos, responda de forma OBJETIVA √† pergunta:

"{query}"

DOCUMENTOS DISPON√çVEIS:
{context_text}

INSTRU√á√ïES OBRIGAT√ìRIAS:
1. Responda de forma NATURAL e DIRETA, como um especialista jur√≠dico
2. Extraia informa√ß√µes ESPEC√çFICAS dos documentos
3. Cite as fontes usando o T√çTULO real da nota t√©cnica
4. Use linguagem clara e profissional, sem express√µes informais
5. Organize as informa√ß√µes de forma l√≥gica e pr√°tica
6. N√£o use [DOCUMENTO X] - use sempre as refer√™ncias reais
7. N√£o use express√µes como "colega", "amigo", "prezado" - seja direto e objetivo
"""
```

## üîÑ Fluxo de Processamento Completo

### **1. Inicializa√ß√£o do Sistema**
```python
# simple_main.py
def configurar_llms():
    default_config = {
        'provider': 'gemini',
        'model': 'gemini-2.5-flash',
        'api_key': os.getenv('GEMINI_API_KEY'),
        'temperature': 0.1,
        'max_tokens': 4000
    }
    
    llm_configs = {
        'default': default_config,
        'research': {
            **default_config,
            'temperature': 0.1,
            'max_tokens': 6000
        }
    }
```

### **2. Orquestra√ß√£o**
```python
# src/agents/simple_orchestrator.py
class SimpleLegalOrchestrator:
    def __init__(self, llm_configs, output_dir=None):
        self._initialize_research_agent()
        self.glossary = GlossaryIntegration()
        self.metrics = {'total_queries': 0, 'research_queries': 0}
```

### **3. Processamento da Query**
```python
async def process_query(self, query: str):
    # 1. Cria contexto
    context = AgentContext(session_id=workflow_id, ...)
    
    # 2. Processa com gloss√°rio
    processed_query = self.glossary.processar_query_completa(query)
    
    # 3. Executa pesquisa
    result = await self._execute_research(query, context)
    
    # 4. Formata resposta
    formatted_result = self._format_research_response(result, query)
    
    # 5. Salva em TXT
    txt_file_path = self._save_response_to_txt(formatted_result, workflow_id, "research")
```

## üìÅ Estrutura de Arquivos Atual

### **Arquivos Principais**
```
‚îú‚îÄ‚îÄ simple_main.py                          # Interface principal
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_agent.py                  # Classe base
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ research_agent.py              # Agente pesquisador
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ simple_orchestrator.py         # Orquestrador
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pinecone_search_tool.py        # Ferramenta Pinecone (personalizada)
‚îÇ   ‚îú‚îÄ‚îÄ glossary/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ technical_glossary.py          # Gloss√°rio t√©cnico
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ glossary_integration.py        # Integra√ß√£o do gloss√°rio
‚îÇ   ‚îú‚îÄ‚îÄ preprocessing/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ query_preprocessor.py          # Pr√©-processamento
‚îÇ   ‚îî‚îÄ‚îÄ postprocessing/
‚îÇ       ‚îî‚îÄ‚îÄ query_postprocessor.py         # P√≥s-processamento
```

### **Arquivos de Configura√ß√£o**
```
‚îú‚îÄ‚îÄ .env                                    # Vari√°veis de ambiente
‚îú‚îÄ‚îÄ requirements.txt                        # Depend√™ncias Python
‚îî‚îÄ‚îÄ pyproject.toml                         # Configura√ß√£o do projeto
```

## üìä M√©tricas e Performance

### **1. Performance Atual**
- **Tempo de Embedding**: 0.3-1.3 segundos
- **Tempo de Busca**: 0.6 segundos
- **Tempo Total**: 12-15 segundos
- **Taxa de Sucesso**: 100%

### **2. Capacidades do Sistema**
- **Base de Conhecimento**: 6.967 documentos
- **Dimens√µes dos Vetores**: 768
- **Threshold de Similaridade**: 0.3+
- **Resultados por Busca**: 5-15 documentos
- **Scores T√≠picos**: 60-80%

## üö® Pontos Cr√≠ticos da Configura√ß√£o

### **1. Host Personalizado do Pinecone**
- **CR√çTICO**: O sistema depende do host `agentes-juridicos-10b89ab.svc.aped-4627-b74a.pinecone.io`
- **Motivo**: Problemas de DNS com hosts padr√£o do Pinecone
- **Solu√ß√£o Implementada**: Bypass do SDK via HTTP direto

### **2. Configura√ß√£o do Embedding**
- **Modelo**: `text-embedding-004` (Google)
- **Dimens√µes**: 768 (fixo)
- **Task Type**: `retrieval_query`

### **3. Configura√ß√£o do LLM**
- **Modelo**: `gemini-2.5-flash`
- **Temperature**: 0.1 (determin√≠stico)
- **Max Tokens**: 6000

## üîß Depend√™ncias e Vers√µes

### **1. Python**
- **Vers√£o**: 3.10.13
- **Arquitetura**: x86_64 (macOS)

### **2. Pacotes Principais**
```bash
google-generativeai>=0.3.0    # Gemini API
pinecone-client>=2.2.4        # Pinecone SDK (n√£o usado atualmente)
python-dotenv>=1.0.0          # Vari√°veis de ambiente
requests                       # HTTP requests (para Pinecone personalizado)
numpy                          # Processamento num√©rico
```

### **3. Estrutura de Diret√≥rios**
```
agente-pesquisa-juridica-v2.0/
‚îú‚îÄ‚îÄ .venv/                    # Ambiente virtual
‚îú‚îÄ‚îÄ src/                      # C√≥digo fonte
‚îú‚îÄ‚îÄ docs/                     # Documenta√ß√£o
‚îú‚îÄ‚îÄ respostas/                # Respostas geradas
‚îú‚îÄ‚îÄ origem/                   # Documentos originais
‚îî‚îÄ‚îÄ testes/                   # Testes do sistema
```

## ‚úÖ Status de Funcionamento

### **1. Componentes Operacionais**
- ‚úÖ **Interface Principal** (`simple_main.py`)
- ‚úÖ **Orquestrador** (`simple_orchestrator.py`)
- ‚úÖ **Agente Pesquisador** (`research_agent.py`)
- ‚úÖ **Ferramenta Pinecone** (vers√£o personalizada)
- ‚úÖ **LLM Gemini** (2.5 Flash)
- ‚úÖ **Gloss√°rio T√©cnico**
- ‚úÖ **Sistema de Arquivos TXT**

### **2. Funcionalidades Testadas**
- ‚úÖ **Conex√£o Pinecone** (host personalizado)
- ‚úÖ **Gera√ß√£o de Embeddings** (text-embedding-004)
- ‚úÖ **Busca Vetorial** (similaridade)
- ‚úÖ **S√≠ntese com LLM** (Gemini 2.5)
- ‚úÖ **Formata√ß√£o de Respostas**
- ‚úÖ **Salvamento em TXT**
- ‚úÖ **M√©tricas do Sistema**

## üéØ Resumo da Configura√ß√£o

O sistema est√° configurado com uma **arquitetura simplificada e robusta** que:

1. **Usa host personalizado** do Pinecone para contornar problemas de DNS
2. **Implementa retrieval direto** via HTTP para m√°xima confiabilidade
3. **Utiliza Gemini 2.5 Flash** para s√≠ntese de alta qualidade
4. **Mant√©m simplicidade** com apenas 3 componentes principais
5. **Preserva funcionalidade completa** de pesquisa jur√≠dica

**Status**: ‚úÖ **SISTEMA TOTALMENTE OPERACIONAL E DOCUMENTADO**

---

**√öltima Atualiza√ß√£o**: 13 de Agosto de 2025  
**Respons√°vel**: Restaura√ß√£o do sistema  
**Vers√£o**: 2.0-simplificada-restaurada
