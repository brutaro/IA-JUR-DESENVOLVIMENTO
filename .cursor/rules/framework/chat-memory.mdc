---
description: "Chat memory management for agents"
alwaysApply: true
globs: ["**/*.md","**/*.chat","**/*.json"]
---

# Chat Memory Rules

## Carregar Histórico
- Antes de gerar a próxima resposta, **ler** o arquivo `chat_history.json` ou buscar do MCP (`memory-mcp-server`)
- Inserir as últimas 10 trocas de usuário/assistente como contexto inicial

## Persistir Novas Mensagens
- Após gerar cada resposta, **append** no `chat_history.json`:
  - `{ "user": "<mensagem>", "assistant": "<resposta>", "timestamp": "<ISO8601>" }`
- Se o arquivo exceder 100 entradas, remover as mais antigas

## Recuperação Contextual
- Para prompts que mencionam tópicos anteriores (ex.: “no contexto disso…”), **pesquisar** em `chat_history.json` pelos últimos tópicos semelhantes
- Se usando MCP, chamar a ferramenta `memory-mcp-server`:
  - `invoke("retrieveMemories", { query: "<tópico>", limit: 5 })`
  - Inserir resultados antes do prompt

## Configuração de Arquivos
- **chat_history.json** no diretório `.cursor/memory/`
- Exemplo de estrutura:
